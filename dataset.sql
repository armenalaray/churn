SET
	SEARCH_PATH TO SOCIALNET7;

WITH
	PARAMS AS (
		SELECT
			INTERVAL '7 day' AS METRIC_PERIOD,
			'2020-02-09'::TIMESTAMP AS OBS_START,
			'2020-05-10'::TIMESTAMP AS OBS_END
	)
SELECT
	m.a
FROM
	METRIC M
	INNER JOIN PARAMS ON METRIC_TIME BETWEEN OBS_START AND OBS_END
	INNER JOIN OBSERVATION O ON M.ACCOUNT_ID = O.ACCOUNT_ID
	AND M.METRIC_TIME > (O.OBSERVATION_DATE - METRIC_PERIOD)::TIMESTAMP
	AND M.METRIC_TIME <= O.OBSERVATION_DATE::TIMESTAMP